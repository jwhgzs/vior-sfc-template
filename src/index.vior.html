<template>
    <h1>TODO list</h1>
    <hr/>
    <ul>
        <todo-item $for="(k, v) in list" :key="k" :value="v" @delete="del($args[0])">
            <slot-provider name="desc">
                {{ v.indexOf('start') == 0 ? 'Start it fast!' : 'Move it!' }}
            </slot-provider>
        </todo-item>
    </ul>
    <div $if="total" $html="total"></div>
    <div $else>Nothing to do!</div>
    <br/>
    <input $value="inputVal" @input="console.log('input: ', $args[0].data)" placeholder="event name"/>
    <button @click="add()" :disabled="! inputVal">add</button>
    <hr/>
    <h3>Powered by Vior</h3>
</template>

<script type="module">
    import todoItemComponent from './todoItem.js'
    
    export default {
        vars() {
            return {
                list: ['leave school', 'finish the homework', 'practise the piano', 'start programming'],
                inputVal: '',
                total() {
                    let text = this.vars.list.join(', ')
                    if (text)
                        return '<strong>You need to do: </strong>' + text
                    else
                        return null
                }
            }
        },
        funcs: {
            add() {
                this.vars.list.push(this.vars.inputVal)
                this.vars.inputVal = ''
            },
            del(id) {
                this.vars.list.splice(id, 1)
            }
        },
        watchers: {
            total() {
                console.log('watcher: total changed')
            }
        },
        comps: {
            'TodoItem': todoItemComponent
        }
    }
</script>